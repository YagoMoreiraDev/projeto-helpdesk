<div class="chamados-wrapper mx-auto">
    <div class="table-responsive rounded-4 shadow-sm overflow-hidden">
        <table class="table table-hover align-middle m-0">
            <thead class="table-dark sticky-top">
                <tr>
                    <th class="fit">#</th>
                    <th>Solicitante</th>
                    <th>Tipo</th>
                    <th>Descrição</th>
                    <th class="nowrap">Data/Hora</th>
                    <th>Técnico</th>
                    <th class="nowrap">Status</th>
                    <th class="fit">Ações</th>
                </tr>
            </thead>

            <tbody>
                <tr *ngFor="let c of chamados; let i = index" class="row-hover">
                    <td class="text-muted fit">{{ i + 1 }}</td>

                    <td>
                        <div class="d-flex align-items-center gap-2">
                            <div class="avatar">{{ c.solicitante[0] || '?' }}</div>
                            <div class="fw-semibold">{{ c.solicitante }}</div>
                        </div>
                    </td>

                    <td class="text-body-emphasis">{{ c.tipo }}</td>

                    <td class="desc">
                        <span class="text-secondary">{{ c.descricao }}</span>
                    </td>

                    <td class="nowrap">
                        {{ c.dataHora | date:'dd/MM/yy HH:mm' }}
                    </td>

                    <td class="text-body-emphasis">
                        <span *ngIf="c.tecnico; else semTec">{{ c.tecnico }}</span>
                        <ng-template #semTec><span class="text-muted">—</span></ng-template>
                    </td>

                    <td class="nowrap">
                        <span class="badge me-2" [ngClass]="badgeClasses(c.status)">
                            {{ badgeLabel(c.status) }}
                        </span>

                        <!-- spinner quando em andamento -->
                        <div *ngIf="c.status === 'EM_ANDAMENTO'"
                            class="spinner-border spinner-border-sm text-warning align-text-bottom" role="status"
                            aria-hidden="true"></div>
                    </td>

                    <td class="fit">
                        <div class="btn-group btn-group-sm" role="group" aria-label="Ações">
                            <button type="button" class="btn btn-outline-primary" (click)="onMudarStatus(c)"
                                title="Mudar status">
                                <i class="bi bi-patch-check-fill"></i>
                            </button>

                            <!-- atribuir técnico: dropdown simples -->
                            <div class="btn-group btn-group-sm dropstart" role="group">
                                <button type="button" class="btn btn-outline-secondary dropdown-toggle"
                                    data-bs-toggle="dropdown" aria-expanded="false" title="Atribuir técnico">
                                    <i class="bi bi-person-vcard-fill"></i>
                                </button>
                                <ul class="dropdown-menu dropdown-menu-end p-0 overflow-auto"
                                    style="max-height: 240px;">
                                    <li *ngFor="let t of tecnicos">
                                        <button type="button" class="dropdown-item" (click)="onAtribuir(c, t)">
                                            {{ t }}
                                        </button>
                                    </li>
                                    <li *ngIf="!tecnicos?.length">
                                        <span class="dropdown-item-text text-muted">Sem técnicos</span>
                                    </li>
                                </ul>
                            </div>

                            <button type="button" class="btn btn-outline-danger" (click)="onExcluir(c)" title="Excluir">
                                <i class="bi bi-trash3"></i>
                            </button>
                        </div>
                    </td>
                </tr>

                <tr *ngIf="!chamados?.length">
                    <td colspan="8" class="text-center py-5 text-muted">
                        Nenhum chamado encontrado.
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>